
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.0">
    
    
      
        <title>Serverless - AI Engineer Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.33e2939f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="purple">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#serverless-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AI Engineer Guide" class="md-header__button md-logo" aria-label="AI Engineer Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AI Engineer Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Serverless
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="purple" type="radio" name="__palette" id="__palette_1">
          <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
          </label>
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal" type="radio" name="__palette" id="__palette_2">
          <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
          </label>
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/mapattacker/ai-engineer/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mapattacker/ai-engineer
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AI Engineer Guide" class="md-nav__button md-logo" aria-label="AI Engineer Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    AI Engineer Guide
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/mapattacker/ai-engineer/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mapattacker/ai-engineer
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../virtual_env/" class="md-nav__link">
        Virtual Environment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../code-standards/" class="md-nav__link">
        Code Standards
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../git/" class="md-nav__link">
        Code Version Control
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dvc/" class="md-nav__link">
        Data Version Control
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../gpu/" class="md-nav__link">
        Using GPU
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mlflow/" class="md-nav__link">
        Model Version
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        Security
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Optimization
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Optimization" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Optimization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../opt-model/" class="md-nav__link">
        Model
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../opt-data/" class="md-nav__link">
        Data
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../opt-para-concurr/" class="md-nav__link">
        Concurrency & Parallelism
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      <label class="md-nav__link" for="__nav_10">
        Deployment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../flask/" class="md-nav__link">
        Flask
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../fastapi/" class="md-nav__link">
        FastAPI
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tf-serving/" class="md-nav__link">
        TF Serving
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        Containerisation
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Testing
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Testing" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Testing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing1/" class="md-nav__link">
        Overview & Pytest
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing-schema/" class="md-nav__link">
        Schema Testing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing2/" class="md-nav__link">
        ML Testing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing-api/" class="md-nav__link">
        API Testing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Serverless
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Serverless
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lambda-api-gateway" class="md-nav__link">
    Lambda &amp; API Gateway
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zappa" class="md-nav__link">
    Zappa
  </a>
  
    <nav class="md-nav" aria-label="Zappa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#venv" class="md-nav__link">
    VENV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-aws-policy-keys-for-zappa-deployment" class="md-nav__link">
    Setup AWS Policy &amp; Keys for Zappa Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use" class="md-nav__link">
    How to Use
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands" class="md-nav__link">
    Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lambda-execution-role" class="md-nav__link">
    Lambda Execution Role
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serverless-framework" class="md-nav__link">
    Serverless Framework
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../demo/" class="md-nav__link">
        Demo Site
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        Monitoring
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cicd/" class="md-nav__link">
        CI/CD
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lambda-api-gateway" class="md-nav__link">
    Lambda &amp; API Gateway
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zappa" class="md-nav__link">
    Zappa
  </a>
  
    <nav class="md-nav" aria-label="Zappa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#venv" class="md-nav__link">
    VENV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-aws-policy-keys-for-zappa-deployment" class="md-nav__link">
    Setup AWS Policy &amp; Keys for Zappa Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use" class="md-nav__link">
    How to Use
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands" class="md-nav__link">
    Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lambda-execution-role" class="md-nav__link">
    Lambda Execution Role
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serverless-framework" class="md-nav__link">
    Serverless Framework
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/mapattacker/ai-engineer/edit/master/docs/serverless.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="serverless-architecture">Serverless Architecture</h1>
<p>Serverless does not mean that are no servers, but rather, refers to a server that will spin up only when required, and shut down when the job is done. Such an architecture has potential to save a lot costs.</p>
<p>Of course, the requirement for serverless is that the job should be something that is light, and not required to run 24/7.</p>
<p>This can be an AI microservice, or intermediate functions, e.g. taking data from S3 &gt; process the data &gt; send to AI microservice.</p>
<hr>

<h2 id="lambda-api-gateway">Lambda &amp; API Gateway</h2>
<p>In AWS, the serverless architecture is done using a lambda function, with an accompanying API gateway (if required), which generates an API URL for the function. The gateway can also control access through an API token, and have rate limits.</p>
<p>It is also important to note that the lambda function can only have a size of <strong>50 Mb</strong>, If required, certain blobs can be stored in S3 and lambda can access from there. It also have a default runtime of 30sec, and can be increase to a maximum of <strong>15 mins</strong>.</p>
<hr>

<h2 id="zappa">Zappa</h2>
<p><a href="https://github.com/zappa/Zappa">Zappa</a> is a popular python library used to automatically launch python lambda functions &amp; api-gateways in AWS.</p>
<h3 id="venv">VENV</h3>
<p>Your application/function needs a virtual environment with all the relevant python libraries installed in the root. See the <a href="https://mapattacker.github.io/ai-engineer/virtual_env/">Virtual Environment</a> example on how to use venv for this. Before zappa deployment, ensure that the venv is activated and the app works.</p>
<h3 id="setup-aws-policy-keys-for-zappa-deployment">Setup AWS Policy &amp; Keys for Zappa Deployment</h3>
<p>The most difficult part of Zappa is to setup a user &amp; policies for zappa to deploy your lambda/gateway application. First, we need to create a new user in AWS, and then define a policy which allows zappa to do all the work for deployment. Then we create the AWS access &amp; secret keys, and port it in our local environment variables.</p>
<p>A healthy discussion on various minimium policies can be viewed <a href="https://github.com/Miserlou/Zappa/issues/244">here</a>. A working liberal example is given below.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;VisualEditor0&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;lambda:CreateFunction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:ListVersionsByFunction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:DeleteFunction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:GetFunctionConfiguration&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:GetAlias&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:InvokeFunction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:GetFunction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:UpdateFunctionConfiguration&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:RemovePermission&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:GetPolicy&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:AddPermission&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:DeleteFunctionConcurrency&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:UpdateFunctionCode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events:PutRule&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events:ListRuleNamesByTarget&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events:ListRules&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events:RemoveTargets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events:ListTargetsByRule&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events:DescribeRule&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events:DeleteRule&quot;</span><span class="p">,</span>
                <span class="s2">&quot;events:PutTargets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;logs:DescribeLogStreams&quot;</span><span class="p">,</span>
                <span class="s2">&quot;logs:FilterLogEvents&quot;</span><span class="p">,</span>
                <span class="s2">&quot;logs:DeleteLogGroup&quot;</span><span class="p">,</span>
                <span class="s2">&quot;apigateway:DELETE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;apigateway:PATCH&quot;</span><span class="p">,</span>
                <span class="s2">&quot;apigateway:GET&quot;</span><span class="p">,</span>
                <span class="s2">&quot;apigateway:PUT&quot;</span><span class="p">,</span>
                <span class="s2">&quot;apigateway:POST&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudformation:DescribeStackResource&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudformation:UpdateStack&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudformation:ListStackResources&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudformation:DescribeStacks&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudformation:CreateStack&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudformation:DeleteStack&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;VisualEditor1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;iam:GetRole&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:PassRole&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:CreateRole&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:AttachRolePolicy&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:PutRolePolicy&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:ListBucketMultipartUploads&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:ListBucket&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;arn:aws:iam::1234567890:role/*-ZappaLambdaExecutionRole&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::&lt;python-serverless-deployment-s3&gt;&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;VisualEditor2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:AbortMultipartUpload&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:DeleteObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:ListMultipartUploadParts&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:s3:::&lt;python-serverless-deployment-s3&gt;/*&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="how-to-use">How to Use</h3>
<p>After installing zappa, we init it at the root of your function, which will create a default zappa_settings.json. </p>
<div class="highlight"><pre><span></span><code>pip install zappa
zappa init
</code></pre></div>
<p>All the instructions to launch the Lambda &amp; API Gateway are set in <code>zappa_settings.json</code>. Refer to the official <a href="https://github.com/Miserlou/Zappa">readme</a> for the entire list. We can have another stage, e.g. "prod" with its own configuration.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;dev&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;app_function&quot;</span><span class="p">:</span> <span class="s2">&quot;app.app&quot;</span><span class="p">,</span>
        <span class="nt">&quot;aws_region&quot;</span><span class="p">:</span> <span class="s2">&quot;ap-southeast-1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;profile_name&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="nt">&quot;project_name&quot;</span><span class="p">:</span> <span class="s2">&quot;maskdetection-lambda&quot;</span><span class="p">,</span>
        <span class="nt">&quot;runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;python3.6&quot;</span><span class="p">,</span>
        <span class="nt">&quot;s3_bucket&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;python-serverless-deployment-s3&gt;&quot;</span><span class="p">,</span>
        <span class="nt">&quot;slim_handler&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nt">&quot;apigateway_description&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda for AI microservice&quot;</span><span class="p">,</span>
        <span class="nt">&quot;lambda_description&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda for AI microservice&quot;</span><span class="p">,</span>
        <span class="nt">&quot;timeout_seconds&quot;</span><span class="p">:</span> <span class="mi">60</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Then, we will deploy it to the cloud, by stating the stage. Behind the scenes, it does all these:</p>
<ul>
<li>New user policy is created for lambda execution</li>
<li>Zappa will do some wrapping of your code &amp; libraries, then package it as a zip</li>
<li>The zip will be uploaded to an S3 bucket stated in zappa_settings.json</li>
<li>Zip file is deleted</li>
<li>Lambda will recieve the zip from S3 and launch the application</li>
<li>API gateway to this lambda is setup</li>
</ul>
<p>We might encounter errors along the way; to view the logs, we can use <code>zappa tail</code>, which extract the tail logs from AWS CloudWatch.</p>
<p>If we are using other frameworks to upload our lambda, e.g. <a href="https://www.serverless.com">Serverless</a>, we can also use zappa to zip the code only.</p>
<h3 id="commands">Commands</h3>
<table>
<thead>
<tr>
<th>Cmd</th>
<th>Desc</th>
</tr>
</thead>
<tbody>
<tr>
<td>zappa init</td>
<td>create a <code>zappa_settings.json</code> file</td>
</tr>
<tr>
<td>zappa deploy <stage></td>
<td>deploy stage as specified in json</td>
</tr>
<tr>
<td>zappa update <stage></td>
<td>update stage</td>
</tr>
<tr>
<td>zappa undeploy <stage></td>
<td>delete lambda &amp; API Gateway</td>
</tr>
<tr>
<td>zappa package <stage></td>
<td>zip all files together</td>
</tr>
<tr>
<td>zappa tail <stage></td>
<td>print tail logs from CloudWatch</td>
</tr>
<tr>
<td>zappa status</td>
<td>check status</td>
</tr>
</tbody>
</table>
<h3 id="lambda-execution-role">Lambda Execution Role</h3>
<p>The default execution role created by zappa is too liberal. From the author "It grants access to all actions for all resources for types CloudWatch, S3, Kinesis, SNS, SQS, DynamoDB, and Route53; lambda:InvokeFunction for all Lambda resources; Put to all X-Ray resources; and all Network Interface operations to all EC2 resources".</p>
<p>To set a manual policy, we need to set the "manage_roles" to <code>false</code> and include either the "role_name" or "role_arn". We then create the role &amp; policies in AWS. </p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;dev&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="err">...</span>
        <span class="nt">&quot;manage_roles&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">//</span> <span class="err">Disable</span> <span class="err">Zappa</span> <span class="err">client</span> <span class="err">managing</span> <span class="err">roles.</span>
        <span class="nt">&quot;role_name&quot;</span><span class="p">:</span> <span class="s2">&quot;MyLambdaRole&quot;</span><span class="p">,</span> <span class="err">//</span> <span class="err">Name</span> <span class="err">of</span> <span class="err">your</span> <span class="err">Zappa</span> <span class="err">execution</span> <span class="err">role.</span> <span class="err">Optional,</span> <span class="err">default:</span> <span class="err">&lt;project_name&gt;-&lt;env&gt;-ZappaExecutionRole.</span>
        <span class="nt">&quot;role_arn&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::12345:role/app-ZappaLambdaExecutionRole&quot;</span><span class="p">,</span> <span class="err">//</span> <span class="err">ARN</span> <span class="err">of</span> <span class="err">your</span> <span class="err">Zappa</span> <span class="err">execution</span> <span class="err">role.</span> <span class="err">Optional.</span>
        <span class="err">...</span>
    <span class="p">},</span>
    <span class="err">...</span>
<span class="p">}</span>
</code></pre></div>
<p>The trick is to first generate the default role, then to filter down the default policy to your specific usecase. Below is an example, which retrieves &amp; updates S3 &amp; DynamnoDB.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;LambdaInvoke&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda:InvokeFunction&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:lambda:ap-southeast-1:123456780:function:complianceai-lambda-dev&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;Logs&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;logs:*&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:logs:ap-southeast-1:123456780:log-group:/aws/lambda/complianceai-lambda-dev:*&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;S3ListObjectsInBucket&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;s3:ListBucket&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:s3:::compliance-bucket&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;S3AllObjectActions&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;s3:*Object&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:s3:::compliance-bucket/*&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;DynamoDBListAndDescribe&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;dynamodb:List*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:DescribeReservedCapacity*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:DescribeLimits&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:DescribeTimeToLive&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;DynamoDBSpecificTable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;dynamodb:BatchGet*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:DescribeStream&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:DescribeTable&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:Get*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:Query&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:Scan&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:BatchWrite*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:CreateTable&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:Delete*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:Update*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dynamodb:PutItem&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:dynamodb:*:*:table/ComplianceTable&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="serverless-framework">Serverless Framework</h2>
<p><a href="https://www.serverless.com/">Serverless Framework</a> is another powerful app to deploy serverless architecture. It's main benefits are being able to deploy to all major cloud providers, i.e. AWS, Azure and GCP, and also supporting multiple languages like nodeJS, Python, Go and Swift. </p>
<p>The instructions for deployment are contained in a ymal file called <code>serverless.yml</code> to be stored at the root directory.</p>
<p>You can check out this python <a href="https://www.serverless.com/blog/flask-python-rest-api-serverless-lambda-dynamodb">blog post</a> and a range of other <a href="https://www.serverless.com/examples/">examples</a> in the serverless website for details.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../testing-api/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              API Testing
            </div>
          </div>
        </a>
      
      
        <a href="../demo/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Demo Site
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.d892486b.min.js"></script>
      
    
  </body>
</html>